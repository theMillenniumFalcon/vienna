version: '3.8'

services:
  vienna:
    build: .
    container_name: vienna-ai
    stdin_open: true
    tty: true
    environment:
      # MongoDB connection
      - MONGODB_URI=${MONGODB_URI}
      - DATABASE_NAME=${DATABASE_NAME:-vienna}
      
      # Anthropic API
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      
      # Gmail OAuth
      - GMAIL_CLIENT_ID=${GMAIL_CLIENT_ID}
      - GMAIL_CLIENT_SECRET=${GMAIL_CLIENT_SECRET}
      - GMAIL_REDIRECT_URI=${GMAIL_REDIRECT_URI:-http://localhost:8080/oauth2callback}
      
      # GitHub OAuth
      - GITHUB_CLIENT_ID=${GITHUB_CLIENT_ID}
      - GITHUB_CLIENT_SECRET=${GITHUB_CLIENT_SECRET}
      - GITHUB_REDIRECT_URI=${GITHUB_REDIRECT_URI:-http://localhost:8080/github/callback}
      
      # Security
      - ENCRYPTION_KEY=${ENCRYPTION_KEY}
      - TOKEN_SALT=${TOKEN_SALT:-vienna_salt}
      
      # Logging
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - LOG_FILE=/app/logs/vienna.log
    
    volumes:
      # Mount logs directory
      - ./logs:/app/logs
      # Mount .env file (optional, if not using environment variables)
      - ./.env:/app/.env:ro
    
    networks:
      - vienna-network
    
    # Port mapping for OAuth callbacks
    ports:
      - "8080:8080"
    
    # Restart policy
    restart: unless-stopped

networks:
  vienna-network:
    driver: bridge

volumes:
  vienna-logs: